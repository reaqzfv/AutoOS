<?xml version="1.0" encoding="utf-8" ?>
<Page x:Class="AutoOS.Views.Settings.SchedulingPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:dev="using:DevWinUI"
      xmlns:local="using:AutoOS"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:views="using:AutoOS.Views"
      xmlns:vm="using:AutoOS.Views.Settings.Scheduling.ViewModels"
      mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <TextBlock Margin="36,24,0,0"
                   Style="{StaticResource TitleTextBlockStyle}"
                   Text="Per-CPU Scheduling" />
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      VerticalScrollMode="Auto">
            <StackPanel Margin="{ThemeResource ContentPageMargin}"
                        Padding="{ThemeResource ContentPagePadding}"
                        dev:PanelAttach.ChildrenTransitions="Default"
                        Spacing="8">
                <dev:SettingsGroup Description="Manage your GPU, XHCI Controller and NIC Affinities."
                                   Header="Per-CPU Scheduling"
                                   HeaderIcon="{dev:BitmapIcon Source=Assets/Fluent/Cpu.png}">
                    <dev:SettingsGroup.Content>
                        <dev:ProgressButton x:Name="Optimize"
                                            HorizontalAlignment="Left"
                                            Checked="Optimize_Checked"
                                            CheckedContent="Optimizing Affinities..."
                                            Content="Optmize Affinities"
                                            IsIndeterminate="True"
                                            Style="{ThemeResource AccentProgressButtonStyle}" />
                    </dev:SettingsGroup.Content>
                    <dev:SettingsGroup.Items>
                        <dev:Card Padding="25,-26,25,17"
                                  BorderThickness="1,0,1,1"
                                  CornerRadius="0,0,8,8">
                            <StackPanel>
                                <Grid Padding="16,0,40,12"
                                      ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="3*"
                                                          MinWidth="440" />
                                        <ColumnDefinition Width="*"
                                                          MinWidth="70" />
                                        <ColumnDefinition Width="*"
                                                          MinWidth="70" />
                                        <ColumnDefinition Width="*"
                                                          MinWidth="100" />
                                        <ColumnDefinition Width="*"
                                                          MinWidth="100" />
                                        <ColumnDefinition Width="*"
                                                          MinWidth="110" />
                                        <ColumnDefinition Width="*"
                                                          MinWidth="120" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Text="Name" />
                                    <TextBlock Grid.Column="1"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Text="MSI Mode" />
                                    <TextBlock Grid.Column="2"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Text="MSI Limit" />
                                    <TextBlock Grid.Column="3"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Text="Max MSI Limit" />
                                    <TextBlock Grid.Column="4"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Text="Device Policy" />
                                    <TextBlock Grid.Column="5"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Text="Device Priority" />
                                    <TextBlock Grid.Column="6"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Text="Specified Processors" />
                                </Grid>
                                <ItemsRepeater ItemsSource="{x:Bind ViewModel.DeviceGroups}">
                                    <ItemsRepeater.Layout>
                                        <StackLayout Orientation="Vertical"
                                                     Spacing="12" />
                                    </ItemsRepeater.Layout>
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate x:DataType="vm:DeviceGroup">
                                            <StackPanel Spacing="4">
                                                <TextBlock Style="{StaticResource SubtitleTextBlockStyle}"
                                                           Text="{x:Bind Title}"
                                                           Visibility="{x:Bind HasItems, Mode=OneWay}" />
                                                <ItemsRepeater ItemsSource="{x:Bind Items}">
                                                    <ItemsRepeater.Layout>
                                                        <StackLayout Orientation="Vertical" />
                                                    </ItemsRepeater.Layout>
                                                    <ItemsRepeater.ItemTemplate>
                                                        <DataTemplate x:DataType="vm:DeviceItemViewModel">
                                                            <dev:SettingsCard Margin="0,4,0,0"
                                                                              Click="DeviceCard_Click"
                                                                              DataContext="{x:Bind}"
                                                                              IsActionIconVisible="False"
                                                                              IsClickEnabled="True">
                                                                <dev:SettingsCard.Description>
                                                                    <Grid ColumnSpacing="12">
                                                                        <Grid.ColumnDefinitions>
                                                                            <ColumnDefinition Width="3*"
                                                                                              MinWidth="440" />
                                                                            <ColumnDefinition Width="*"
                                                                                              MinWidth="70" />
                                                                            <ColumnDefinition Width="*"
                                                                                              MinWidth="70" />
                                                                            <ColumnDefinition Width="*"
                                                                                              MinWidth="100" />
                                                                            <ColumnDefinition Width="*"
                                                                                              MinWidth="100" />
                                                                            <ColumnDefinition Width="*"
                                                                                              MinWidth="110" />
                                                                            <ColumnDefinition Width="*"
                                                                                              MinWidth="120" />
                                                                        </Grid.ColumnDefinitions>
                                                                        <TextBlock Style="{StaticResource BodyStrongTextBlockStyle}"
                                                                                   Text="{x:Bind DisplayName}" />
                                                                        <TextBlock Grid.Column="1"
                                                                                   Style="{StaticResource BodyTextBlockStyle}"
                                                                                   Text="{x:Bind MsiModeDisplay}" />
                                                                        <TextBlock Grid.Column="2"
                                                                                   Style="{StaticResource BodyTextBlockStyle}"
                                                                                   Text="{x:Bind MsiLimitDisplay}" />
                                                                        <TextBlock Grid.Column="3"
                                                                                   Style="{StaticResource BodyTextBlockStyle}"
                                                                                   Text="{x:Bind MaxMSILimitDisplay}" />
                                                                        <TextBlock Grid.Column="4"
                                                                                   Style="{StaticResource BodyTextBlockStyle}"
                                                                                   Text="{x:Bind DevicePolicyDisplay}" />
                                                                        <TextBlock Grid.Column="5"
                                                                                   Style="{StaticResource BodyTextBlockStyle}"
                                                                                   Text="{x:Bind DevicePriorityDisplay}" />
                                                                        <TextBlock Grid.Column="6"
                                                                                   Style="{StaticResource BodyTextBlockStyle}"
                                                                                   Text="{x:Bind SpecifiedProcessorsDisplay}" />
                                                                    </Grid>
                                                                </dev:SettingsCard.Description>
                                                            </dev:SettingsCard>
                                                        </DataTemplate>
                                                    </ItemsRepeater.ItemTemplate>
                                                </ItemsRepeater>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </StackPanel>
                        </dev:Card>
                    </dev:SettingsGroup.Items>
                </dev:SettingsGroup>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
