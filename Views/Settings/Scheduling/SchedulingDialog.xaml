<Page x:Class="AutoOS.Views.Settings.Scheduling.SchedulingDialog"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:controls="using:CommunityToolkit.WinUI.Controls"
      xmlns:dev="using:DevWinUI"
      xmlns:models="using:AutoOS.Views.Settings.Scheduling.Models"
      xmlns:vm="using:AutoOS.Views.Settings.Scheduling.ViewModels">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <TextBlock Margin="0,0,0,24"
                   Style="{StaticResource TitleTextBlockStyle}"
                   Text="{x:Bind Title, Mode=OneWay}" />
        <ScrollViewer Grid.Row="1"
                      HorizontalAlignment="Stretch"
                      VerticalScrollBarVisibility="Auto"
                      VerticalScrollMode="Auto">
            <StackPanel Spacing="12">
                <Grid ColumnSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <dev:Card Title="MSI Policies"
                              Grid.Column="0"
                              HorizontalAlignment="Stretch">
                        <StackPanel Spacing="12">
                            <CheckBox Content="MSI Mode:"
                                      IsChecked="{x:Bind ViewModel.MsiSupported, Mode=TwoWay}" />

                            <Grid ColumnSpacing="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0"
                                           VerticalAlignment="Center"
                                           Text="MSI Limit:" />

                                <NumberBox Grid.Column="1"
                                           IsEnabled="{x:Bind ViewModel.IsMsiLimitEnabled, Mode=OneWay}"
                                           Maximum="{x:Bind ViewModel.EffectiveMaxMSILimit, Mode=OneWay}"
                                           Minimum="0"
                                           SpinButtonPlacementMode="Inline"
                                           ValueChanged="MessageNumberLimit_ValueChanged"
                                           Value="{x:Bind ViewModel.MessageNumberLimit, Mode=TwoWay}" />
                            </Grid>
                        </StackPanel>
                    </dev:Card>
                    <dev:Card Title="Advanced Policies"
                              Grid.Column="1"
                              HorizontalAlignment="Stretch">
                        <Grid ColumnSpacing="12"
                              RowSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0"
                                       Grid.Column="0"
                                       VerticalAlignment="Center"
                                       Text="Device Priority:" />
                            <ComboBox Grid.Row="0"
                                      Grid.Column="1"
                                      ItemsSource="{x:Bind ViewModel.IrqPriorities, Mode=OneWay}"
                                      SelectedIndex="{x:Bind ViewModel.DevicePriority, Mode=TwoWay}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <TextBlock Grid.Row="1"
                                       Grid.Column="0"
                                       VerticalAlignment="Center"
                                       Text="Device Policy:" />
                            <ComboBox Grid.Row="1"
                                      Grid.Column="1"
                                      ItemsSource="{x:Bind ViewModel.IrqPolicies, Mode=OneWay}"
                                      SelectedIndex="{x:Bind ViewModel.DevicePolicy, Mode=TwoWay}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </Grid>
                    </dev:Card>
                </Grid>
                <StackPanel Spacing="8">
                    <Grid ColumnSpacing="{x:Bind ViewModel.ColumnSpacing, Mode=OneWay}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="{x:Bind ViewModel.ECoreColumnWidth, Mode=OneWay}" />
                        </Grid.ColumnDefinitions>
                        <ScrollViewer Grid.Column="0"
                                      HorizontalScrollBarVisibility="Disabled"
                                      HorizontalScrollMode="Disabled"
                                      VerticalScrollBarVisibility="Auto"
                                      VerticalScrollMode="Auto">
                            <dev:Card Title="P-Cores"
                                      IsEnabled="{x:Bind ViewModel.IsCoreSelectionEnabled, Mode=OneWay}">
                                <Grid>
                                    <ItemsRepeater HorizontalAlignment="Stretch"
                                                   ItemsSource="{x:Bind ViewModel.PCores, Mode=OneWay}">
                                        <ItemsRepeater.Layout>
                                            <controls:StaggeredLayout ColumnSpacing="8"
                                                                      DesiredColumnWidth="140"
                                                                      ItemsStretch="Fill"
                                                                      RowSpacing="8" />
                                        </ItemsRepeater.Layout>
                                        <ItemsRepeater.ItemTemplate>
                                            <DataTemplate x:DataType="models:CpuCore">
                                                <dev:Card Title="{x:Bind Name}"
                                                          HorizontalAlignment="Stretch">
                                                    <Grid>
                                                        <ItemsRepeater HorizontalAlignment="Stretch"
                                                                       ItemsSource="{x:Bind Threads}">
                                                            <ItemsRepeater.ItemTemplate>
                                                                <DataTemplate x:DataType="models:CpuThread">
                                                                    <CheckBox Content="{x:Bind Name}"
                                                                              IsChecked="{x:Bind IsSelected, Mode=TwoWay}" />
                                                                </DataTemplate>
                                                            </ItemsRepeater.ItemTemplate>
                                                        </ItemsRepeater>
                                                    </Grid>
                                                </dev:Card>
                                            </DataTemplate>
                                        </ItemsRepeater.ItemTemplate>
                                    </ItemsRepeater>
                                </Grid>
                            </dev:Card>
                        </ScrollViewer>
                        <ScrollViewer Grid.Column="1"
                                      HorizontalAlignment="Stretch"
                                      HorizontalScrollBarVisibility="Disabled"
                                      HorizontalScrollMode="Disabled"
                                      VerticalScrollBarVisibility="Auto"
                                      VerticalScrollMode="Auto"
                                      Visibility="{x:Bind ViewModel.HasEfficiencyClass, Mode=OneWay}">
                            <dev:Card Title="E-Cores"
                                      HorizontalAlignment="Stretch"
                                      IsEnabled="{x:Bind ViewModel.IsCoreSelectionEnabled, Mode=OneWay}">
                                <ItemsRepeater ItemsSource="{x:Bind ViewModel.ECores, Mode=OneWay}">
                                    <ItemsRepeater.Layout>
                                        <controls:StaggeredLayout ColumnSpacing="8"
                                                                  DesiredColumnWidth="140"
                                                                  ItemsStretch="Fill"
                                                                  RowSpacing="8" />
                                    </ItemsRepeater.Layout>
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate x:DataType="models:CpuCore">
                                            <dev:Card Title="{x:Bind Name}">
                                                <StackPanel>
                                                    <ItemsRepeater ItemsSource="{x:Bind Threads}">
                                                        <ItemsRepeater.ItemTemplate>
                                                            <DataTemplate x:DataType="models:CpuThread">
                                                                <CheckBox Content="{x:Bind Name}"
                                                                          IsChecked="{x:Bind IsSelected, Mode=TwoWay}" />
                                                            </DataTemplate>
                                                        </ItemsRepeater.ItemTemplate>
                                                    </ItemsRepeater>
                                                </StackPanel>
                                            </dev:Card>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </dev:Card>
                        </ScrollViewer>
                    </Grid>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
